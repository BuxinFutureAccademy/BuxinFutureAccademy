{% extends "base.html" %}

{% block content %}
<style>
    :root {
        --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --primary-solid: #6366f1;
        --primary-dark: #4f46e5;
        --secondary: #8b5cf6;
        --accent: #06b6d4;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #0f172a;
        --gray: #64748b;
        --light: #f8fafc;
        --white: #ffffff;
        --border: rgba(226, 232, 240, 0.3);
        --glass: rgba(255, 255, 255, 0.1);
        --glass-dark: rgba(15, 23, 42, 0.8);
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.15);
        --radius: 24px;
        --radius-sm: 16px;
        --radius-xs: 12px;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
    }

    input, textarea {
        -webkit-user-select: text;
        user-select: text;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
        line-height: 1.5;
        color: var(--dark);
        background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }

    /* Mobile-First Hero Section */
    .hero-section {
        position: relative;
        background: var(--primary);
        min-height: 100vh;
        display: flex;
        align-items: center;
        overflow: hidden;
        padding: max(env(safe-area-inset-top), 20px) 16px 40px;
    }

    .hero-bg-pattern {
        position: absolute;
        inset: 0;
        background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M20 20.5V18H18V20.5H15.5V22.5H18V25H20V22.5H22.5V20.5H20ZM12 12.5V10H10V12.5H7.5V14.5H10V17H12V14.5H14.5V12.5H12Z'/%3E%3C/g%3E%3C/svg%3E");
        animation: patternMove 30s linear infinite;
        opacity: 0.7;
    }

    .hero-content {
        position: relative;
        z-index: 10;
        width: 100%;
        max-width: 100%;
        text-align: center;
        padding: 0 4px;
    }

    .robot-arms-container {
        position: absolute;
        top: -100px;
        left: 0;
        right: 0;
        height: 200px;
        pointer-events: none;
        z-index: 1;
    }

    .robot-arm {
        position: absolute;
        width: 80px;
        height: auto;
        animation: float 4s ease-in-out infinite;
        filter: drop-shadow(0 4px 12px rgba(0,0,0,0.2));
    }

    .robot-arm img {
        width: 100%;
        height: auto;
    }

    .left-arm {
        left: 10px;
        animation-delay: -1s;
    }

    .left-arm img {
        transform: scaleX(-1);
    }

    .right-arm {
        right: 10px;
        animation-delay: -3s;
    }

    .hero-greeting {
        color: rgba(255, 255, 255, 0.9);
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
        opacity: 0;
        animation: slideUp 0.8s ease forwards 0.2s;
    }

    .hero-title {
        color: white;
        font-size: clamp(2.2rem, 8vw, 3rem);
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 12px;
        opacity: 0;
        animation: slideUp 0.8s ease forwards 0.4s;
    }

    .hero-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 16px;
        font-weight: 400;
        margin-bottom: 32px;
        opacity: 0;
        animation: slideUp 0.8s ease forwards 0.6s;
    }

    /* Mobile-Optimized Search Bar */
    .search-container {
        margin-bottom: 24px;
        opacity: 0;
        animation: slideUp 0.8s ease forwards 0.8s;
        position: relative;
    }

    .search-bar {
        position: relative;
        background: var(--glass);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        min-height: 48px; /* Touch-friendly minimum */
    }

    .search-bar:focus-within {
        background: rgba(255, 255, 255, 0.95);
        border-color: rgba(255, 255, 255, 0.5);
        transform: scale(1.02);
        box-shadow: var(--shadow-lg);
    }

    .search-icon {
        color: rgba(255, 255, 255, 0.7);
        font-size: 16px;
        transition: color 0.3s ease;
        flex-shrink: 0;
    }

    .search-bar:focus-within .search-icon {
        color: var(--primary-solid);
    }

    .search-input {
        flex: 1;
        background: none;
        border: none;
        outline: none;
        color: white;
        font-size: 16px;
        font-weight: 500;
        -webkit-appearance: none;
    }

    .search-input::placeholder {
        color: rgba(255, 255, 255, 0.6);
    }

    .search-bar:focus-within .search-input {
        color: var(--dark);
    }

    .search-bar:focus-within .search-input::placeholder {
        color: var(--gray);
    }

    .voice-search {
        width: 36px;
        height: 36px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        flex-shrink: 0;
        font-size: 14px;
    }

    .voice-search:active {
        transform: scale(0.95);
        background: rgba(255, 255, 255, 0.3);
    }

    /* Mobile Search Results */
    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border-radius: var(--radius-sm);
        margin-top: 8px;
        box-shadow: var(--shadow-lg);
        z-index: 2000;
        max-height: 60vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
    }

    .search-results.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .search-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        text-decoration: none;
        color: inherit;
        border-bottom: 1px solid #f1f5f9;
        transition: all 0.2s ease;
        min-height: 60px; /* Touch-friendly */
    }

    .search-item:last-child {
        border-bottom: none;
    }

    .search-item:active {
        background: #f8fafc;
        transform: scale(0.98);
    }

    .search-item-icon {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        color: white;
        flex-shrink: 0;
    }

    .search-item-content {
        flex: 1;
        min-width: 0; /* Allow text truncation */
    }

    .search-item-title {
        font-size: 15px;
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .search-item-subtitle {
        font-size: 13px;
        color: var(--gray);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .search-item-price {
        font-size: 13px;
        font-weight: 700;
        color: var(--primary-solid);
        flex-shrink: 0;
    }

    /* Stats Section - Mobile Optimized */
    .stats-section {
        background: white;
        margin: -20px 16px 0;
        border-radius: var(--radius) var(--radius) 0 0;
        padding: 32px 16px 16px;
        position: relative;
        z-index: 10;
        box-shadow: var(--shadow);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    .stat-card {
        text-align: center;
        padding: 16px 12px;
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        transition: all 0.3s ease;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .stat-card:active {
        transform: scale(0.95);
        box-shadow: var(--shadow);
    }

    .stat-number {
        font-size: 20px;
        font-weight: 800;
        color: var(--primary-solid);
        margin-bottom: 2px;
        display: block;
    }

    .stat-label {
        font-size: 11px;
        color: var(--gray);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Main Content - Mobile First */
    .main-content {
        background: white;
        padding: 0 16px 40px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-top: 32px;
    }

    .section-title {
        font-size: 20px;
        font-weight: 800;
        color: var(--dark);
    }

    .see-all {
        color: var(--primary-solid);
        text-decoration: none;
        font-weight: 600;
        font-size: 13px;
        padding: 6px 12px;
        border-radius: 16px;
        background: rgba(99, 102, 241, 0.1);
        transition: all 0.2s ease;
        min-height: 32px;
        display: flex;
        align-items: center;
    }

    .see-all:active {
        background: rgba(99, 102, 241, 0.2);
        transform: scale(0.95);
    }

    /* Mobile-Optimized Categories Grid */
    .main-categories {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 32px;
        padding-top: 16px;
    }

    .category-card {
        background: white;
        border-radius: var(--radius);
        padding: 20px 16px;
        text-align: center;
        text-decoration: none;
        color: inherit;
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        min-height: 140px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .category-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .category-card:active {
        transform: scale(0.95);
        box-shadow: var(--shadow-lg);
    }

    .category-card:active::before {
        transform: scaleX(1);
    }

    .category-icon {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-xs);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        margin: 0 auto 12px;
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
    }

    .category-card:nth-child(1) .category-icon { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .category-card:nth-child(2) .category-icon { background: linear-gradient(135deg, var(--primary-solid), var(--secondary)); }
    .category-card:nth-child(3) .category-icon { background: linear-gradient(135deg, var(--accent), #0891b2); }
    .category-card:nth-child(4) .category-icon { background: linear-gradient(135deg, var(--success), #059669); }
    .category-card:nth-child(5) .category-icon { background: linear-gradient(135deg, var(--warning), #d97706); }
    .category-card:nth-child(6) .category-icon { background: linear-gradient(135deg, #ec4899, #db2777); }

    .category-title {
        font-size: 15px;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 4px;
        line-height: 1.2;
    }

    .category-subtitle {
        font-size: 12px;
        color: var(--gray);
        margin-bottom: 8px;
        line-height: 1.3;
    }

    .category-count {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary-solid);
        padding: 4px 8px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 700;
        display: inline-block;
    }

    /* Mobile Feature Cards */
    .features-grid {
        display: grid;
        gap: 16px;
        margin-bottom: 32px;
    }

    .feature-card {
        background: white;
        border-radius: var(--radius);
        padding: 20px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .feature-card:active {
        transform: scale(0.98);
        box-shadow: var(--shadow-lg);
    }

    .feature-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
    }

    .feature-icon {
        width: 40px;
        height: 40px;
        background: var(--primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 16px;
        flex-shrink: 0;
    }

    .feature-badge {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
        padding: 3px 8px;
        border-radius: 10px;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .feature-title {
        font-size: 15px;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 4px;
    }

    .feature-description {
        font-size: 13px;
        color: var(--gray);
        line-height: 1.4;
    }

    /* Mobile CTA Section */
    .cta-section {
        background: var(--primary);
        border-radius: var(--radius);
        padding: 24px 20px;
        text-align: center;
        color: white;
        margin: 32px 0;
        position: relative;
        overflow: hidden;
    }

    .cta-title {
        font-size: 20px;
        font-weight: 800;
        margin-bottom: 8px;
    }

    .cta-subtitle {
        opacity: 0.9;
        margin-bottom: 20px;
        font-size: 14px;
    }

    .cta-buttons {
        display: flex;
        gap: 8px;
        flex-direction: column;
    }

    .cta-button {
        padding: 14px 24px;
        border-radius: 14px;
        text-decoration: none;
        font-weight: 700;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        cursor: pointer;
        border: none;
        font-size: 15px;
        min-height: 48px;
    }

    .cta-button.primary {
        background: white;
        color: var(--primary-solid);
    }

    .cta-button.secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .cta-button:active {
        transform: scale(0.95);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    /* Mobile Floating Action Button */
    .fab {
        position: fixed;
        bottom: max(20px, env(safe-area-inset-bottom));
        right: 16px;
        width: 56px;
        height: 56px;
        background: var(--primary);
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        cursor: pointer;
        box-shadow: var(--shadow-lg);
        z-index: 1000;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .fab:active {
        transform: scale(0.9);
        box-shadow: 0 15px 30px rgba(99, 102, 241, 0.4);
    }

    /* Mobile Chat Modal */
    .chat-modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 3000;
        padding: 16px;
    }

    .chat-modal.show {
        display: flex;
    }

    .chat-content {
        background: white;
        border-radius: var(--radius);
        width: 100%;
        max-width: 400px;
        padding: 24px;
        box-shadow: var(--shadow-lg);
        position: relative;
        max-height: 80vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    .chat-close {
        position: absolute;
        top: 12px;
        right: 16px;
        background: none;
        border: none;
        font-size: 24px;
        color: var(--gray);
        cursor: pointer;
        padding: 4px;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .chat-close:active {
        background: #f1f5f9;
        transform: scale(0.9);
    }

    .chat-form {
        margin-top: 12px;
    }

    .chat-input {
        width: 100%;
        margin-bottom: 12px;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        font-size: 16px;
        background: white;
        -webkit-appearance: none;
        outline: none;
        transition: border-color 0.2s ease;
    }

    .chat-input:focus {
        border-color: var(--primary-solid);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .chat-textarea {
        min-height: 80px;
        resize: vertical;
        font-family: inherit;
    }

    .chat-submit {
        width: 100%;
        padding: 14px;
        background: var(--primary-solid);
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        min-height: 48px;
    }

    .chat-submit:active {
        transform: scale(0.98);
        background: var(--primary-dark);
    }

    .chat-status {
        margin-top: 8px;
        font-size: 14px;
        text-align: center;
    }

    /* Animations */
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes patternMove {
        0% { transform: translate(0, 0); }
        100% { transform: translate(40px, 40px); }
    }

    @keyframes float {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-10px);
        }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }

    /* Loading States */
    .loading-spinner {
        width: 16px;
        height: 16px;
        border: 2px solid #e2e8f0;
        border-top: 2px solid var(--primary-solid);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    .search-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 20px;
        color: var(--gray);
        font-size: 14px;
    }

    /* Responsive Improvements */
    @media (min-width: 480px) {
        .hero-section {
            padding: max(env(safe-area-inset-top), 30px) 24px 50px;
        }

        .stats-section {
            margin: -30px 24px 0;
            padding: 40px 24px 20px;
        }

        .stats-grid {
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .main-content {
            padding: 0 24px 50px;
        }

        .main-categories {
            grid-template-columns: repeat(3, 1fr);
        }

        .features-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .robot-arm {
            width: 100px;
        }

        .left-arm {
            left: 20px;
        }

        .right-arm {
            right: 20px;
        }
    }

    @media (min-width: 768px) {
        .main-categories {
            grid-template-columns: repeat(4, 1fr);
        }

        .features-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        .cta-buttons {
            flex-direction: row;
            justify-content: center;
        }

        .robot-arm {
            width: 120px;
        }

        .left-arm {
            left: 40px;
        }

        .right-arm {
            right: 40px;
        }
    }

    /* Dark Mode Support */
    @media (prefers-color-scheme: dark) {
        :root {
            --dark: #ffffff;
            --gray: #94a3b8;
            --light: #1e293b;
            --white: #0f172a;
            --border: rgba(148, 163, 184, 0.2);
        }

        body {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
        }

        .stats-section,
        .main-content,
        .category-card,
        .feature-card,
        .search-results,
        .chat-content {
            background: #1e293b;
            border-color: rgba(148, 163, 184, 0.2);
        }

        .search-item:active {
            background: #334155;
        }

        .chat-input {
            background: #334155;
            border-color: rgba(148, 163, 184, 0.2);
            color: white;
        }
    }

    /* Performance Optimizations */
    .category-card,
    .feature-card,
    .search-item,
    .cta-button,
    .fab {
        will-change: transform;
    }

    /* Accessibility Improvements */
    @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }

    /* Focus States for Better Accessibility */
    .category-card:focus,
    .feature-card:focus,
    .cta-button:focus,
    .fab:focus,
    .search-input:focus,
    .chat-input:focus {
        outline: 2px solid var(--primary-solid);
        outline-offset: 2px;
    }

    /* Mobile Bottom Navigation */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-top: 1px solid var(--border);
        padding: max(8px, env(safe-area-inset-bottom)) 0 max(8px, env(safe-area-inset-bottom));
        z-index: 1000;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
    }

    .bottom-nav-content {
        display: flex;
        justify-content: space-around;
        align-items: center;
        max-width: 100%;
        margin: 0 auto;
        padding: 0 8px;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 8px 12px;
        text-decoration: none;
        color: var(--gray);
        transition: all 0.3s ease;
        border-radius: 12px;
        min-width: 60px;
        position: relative;
        cursor: pointer;
    }

    .nav-item:active {
        transform: scale(0.95);
        background: rgba(99, 102, 241, 0.1);
    }

    .nav-item.active {
        color: var(--primary-solid);
        background: rgba(99, 102, 241, 0.1);
    }

    .nav-item.active::before {
        content: '';
        position: absolute;
        top: -1px;
        left: 50%;
        transform: translateX(-50%);
        width: 20px;
        height: 3px;
        background: var(--primary-solid);
        border-radius: 0 0 8px 8px;
    }

    .nav-icon {
        font-size: 20px;
        margin-bottom: 4px;
        transition: all 0.3s ease;
    }

    .nav-item:active .nav-icon {
        transform: scale(1.1);
    }

    .nav-label {
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }

    .nav-badge {
        position: absolute;
        top: 6px;
        right: 8px;
        background: var(--danger);
        color: white;
        font-size: 10px;
        font-weight: 700;
        padding: 2px 6px;
        border-radius: 10px;
        min-width: 16px;
        text-align: center;
        line-height: 1.2;
    }

    /* Adjust main content for bottom nav */
    .main-content {
        padding-bottom: max(100px, calc(80px + env(safe-area-inset-bottom)));
    }

    /* Hide FAB when bottom nav is present */
    .fab {
        display: none;
    }

    /* Dark mode support for bottom nav */
    @media (prefers-color-scheme: dark) {
        .bottom-nav {
            background: rgba(30, 41, 59, 0.95);
            border-top-color: rgba(148, 163, 184, 0.2);
        }
    }

    /* Responsive adjustments */
    @media (min-width: 768px) {
        .bottom-nav {
            display: none; /* Hide on tablets/desktop */
        }
        
        .main-content {
            padding-bottom: 60px; /* Reset padding */
        }
        
        .fab {
            display: flex; /* Show FAB on larger screens */
        }
    }

    /* Prevent zoom on input focus for iOS */
    @media screen and (-webkit-min-device-pixel-ratio: 0) {
        select,
        textarea,
        input[type="text"],
        input[type="password"],
        input[type="datetime"],
        input[type="datetime-local"],
        input[type="date"],
        input[type="month"],
        input[type="time"],
        input[type="week"],
        input[type="number"],
        input[type="email"],
        input[type="url"],
        input[type="search"],
        input[type="tel"],
        input[type="color"] {
            font-size: 16px;
        }
    }
</style>

<!-- Use Font Awesome 6 for better mobile performance -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Hero Section -->
<div class="hero-section">
    <div class="hero-bg-pattern"></div>
    
    <!-- Robotic Arm Animation -->
    <!-- Left Robot Arm -->
    <div class="robot-arm left-arm">
        <img src="https://res.cloudinary.com/dfizb64hx/image/upload/v1753482527/Robotic_Claw_txevm9.gif" alt="Robot Arm Left">
    </div>

    <!-- Right Robot Arm -->
    <div class="robot-arm right-arm">
        <img src="https://res.cloudinary.com/dfizb64hx/image/upload/v1753482527/Robotic_Claw_txevm9.gif" alt="Robot Arm Right">
    </div>

    <div class="hero-content">
        {% if current_user.is_authenticated %}
            <div class="hero-greeting">Welcome back</div>
            <h1 class="hero-title">What will you learn today, {{ current_user.first_name }}?</h1>
            <p class="hero-subtitle">Continue your robotics journey</p>
        {% else %}
            <div class="hero-greeting">Discover & Learn</div>
            <h1 class="hero-title">Master Robotics</h1>
            <p class="hero-subtitle">Build the future with AI-powered learning</p>
        {% endif %}

        <!-- Mobile-Optimized Search -->
        <div class="search-container">
            <div class="search-bar">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="Search courses, classes, products..." id="globalSearch" autocomplete="off" autocorrect="off" spellcheck="false">
                <button class="voice-search" aria-label="Voice search">
                    <i class="fas fa-microphone"></i>
                </button>
            </div>
            
            <!-- Search Results -->
            <div class="search-results" id="searchResults">
                <div class="search-loading" id="searchLoading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <span>Searching...</span>
                </div>
                <div class="search-content" id="searchContent"></div>
            </div>
        </div>
    </div>
</div>

<!-- Stats Section -->
<div class="stats-section">
    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-number">15K+</span>
            <span class="stat-label">Active Learners</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">500+</span>
            <span class="stat-label">Projects Built</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">24/7</span>
            <span class="stat-label">AI Support</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">98%</span>
            <span class="stat-label">Success Rate</span>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">
    <!-- Main Categories -->
    <div class="main-categories">
        <a href="{{ url_for('store.store') }}" class="category-card">
            <div class="category-icon">
                <i class="fas fa-users"></i>
            </div>
            <h3 class="category-title">Classes</h3>
            <p class="category-subtitle">Live interactive sessions</p>
            <div class="category-count">12 Live Now</div>
        </a>
        
        <a href="{{ url_for('student_projects.student_projects') }}" class="category-card">
            <div class="category-icon">
                <i class="fas fa-lightbulb"></i>
            </div>
            <h3 class="category-title">Student Projects</h3>
            <p class="category-subtitle">Showcase & Inspiration</p>
            <div class="category-count">50+ Projects</div>
        </a>
        
        <a href="{{ url_for('store.store') }}" class="category-card">
            <div class="category-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <h3 class="category-title">Store</h3>
            <p class="category-subtitle">Robotics kits & parts</p>
            <div class="category-count">200+ Items</div>
        </a>
        
        <a href="{{ url_for('integrations.ai_assistant') }}" class="category-card">
            <div class="category-icon">
                <i class="fas fa-robot"></i>
            </div>
            <h3 class="category-title">AI Assistant</h3>
            <p class="category-subtitle">Smart learning help</p>
            <div class="category-count">24/7</div>
        </a>

        <a href="{{ url_for('store.store') }}" class="category-card">
            <div class="category-icon">
                <i class="fas fa-box-open"></i>
            </div>
            <h3 class="category-title">Courses</h3>
            <p class="category-subtitle">All available Courses</p>
            <div class="category-count">150+ Courses</div>
        </a>

        <a href="{{ url_for('projects.robotics_projects') }}" class="category-card">
            <div class="category-icon">
                <i class="fas fa-microchip"></i>
            </div>
            <h3 class="category-title">Ideas</h3>
            <p class="category-subtitle">Project inspiration</p>
            <div class="category-count">100+ Works</div>
        </a>
    </div>

    <!-- Features Section -->
    <div class="section-header">
        <h2 class="section-title">Why Choose Us?</h2>
    </div>
    
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-header">
                <div class="feature-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="feature-badge">AI Powered</div>
            </div>
            <h4 class="feature-title">Smart AI Assistant</h4>
            <p class="feature-description">Get instant help with coding, debugging, and project guidance 24/7</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                    <i class="fas fa-video"></i>
                </div>
                <div class="feature-badge" style="background: rgba(239, 68, 68, 0.1); color: #dc2626;">Live</div>
            </div>
            <h4 class="feature-title">Live Expert Classes</h4>
            <p class="feature-description">Interactive sessions with industry experts and real-time Q&A</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                    <i class="fas fa-cube"></i>
                </div>
                <div class="feature-badge" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">Premium</div>
            </div>
            <h4 class="feature-title">Hands-on Kits</h4>
            <p class="feature-description">Complete robotics kits delivered to your door with guided projects</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, #ec4899, #db2777);">
                    <i class="fas fa-users"></i>
                </div>
                <div class="feature-badge" style="background: rgba(236, 72, 153, 0.1); color: #db2777;">Community</div>
            </div>
            <h4 class="feature-title">Global Community</h4>
            <p class="feature-description">Connect with fellow makers, share projects, and learn together</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, var(--success), #059669);">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <div class="feature-badge">Projects</div>
            </div>
            <h4 class="feature-title">Submit Projects</h4>
            <p class="feature-description">Share your robotics innovations and get feedback from experts</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, var(--accent), #0891b2);">
                    <i class="fas fa-certificate"></i>
                </div>
                <div class="feature-badge" style="background: rgba(6, 182, 212, 0.1); color: var(--accent);">Certified</div>
            </div>
            <h4 class="feature-title">Industry Certificates</h4>
            <p class="feature-description">Earn recognized credentials to advance your robotics career</p>
        </div>
    </div>

    <!-- What's New Section -->
    <div class="section-header">
        <h2 class="section-title">What's New</h2>
        <a href="{{ url_for('store.store') }}" class="see-all">See Updates</a>
    </div>
    
    <div class="features-grid">
        <div class="feature-card" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), white);">
            <div class="feature-header">
                <div class="feature-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="feature-badge">New</div>
            </div>
            <h4 class="feature-title">Advanced AI Tutor</h4>
            <p class="feature-description">Personalized learning paths powered by machine learning algorithms</p>
        </div>
        
        <div class="feature-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), white);">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                    <i class="fas fa-car"></i>
                </div>
                <div class="feature-badge" style="background: rgba(239, 68, 68, 0.1); color: #dc2626;">Live</div>
            </div>
            <h4 class="feature-title">EV Workshop Series</h4>
            <p class="feature-description">Build your own electric vehicle from scratch in live workshops</p>
        </div>
        
        <div class="feature-card" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), white);">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                    <i class="fas fa-drone"></i>
                </div>
                <div class="feature-badge" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">Featured</div>
            </div>
            <h4 class="feature-title">Drone Programming</h4>
            <p class="feature-description">Master autonomous flight control and computer vision for drones</p>
        </div>
    </div>

    <!-- Call to Action -->
    {% if not current_user.is_authenticated %}
    <div class="cta-section">
        <div class="cta-content">
            <h3 class="cta-title">Start Your Journey Today</h3>
            <p class="cta-subtitle">Join thousands of students building the future with robotics</p>
            <div class="cta-buttons">
                <a href="{{ url_for('auth.register') }}" class="cta-button primary">
                    <i class="fas fa-rocket"></i>
                    Start Free Trial
                </a>
                <a href="{{ url_for('auth.login') }}" class="cta-button secondary">
                    <i class="fas fa-sign-in-alt"></i>
                    Sign In
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Additional Options -->
    <div class="section-header">
        <h2 class="section-title">Explore More</h2>
    </div>
    
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, var(--success), #059669);">
                    <i class="fas fa-lightbulb"></i>
                </div>
            </div>
            <h4 class="feature-title">
                <a href="{{ url_for('projects.robotics_projects') }}" style="text-decoration: none; color: inherit;">Projects Gallery</a>
            </h4>
            <p class="feature-description">Explore amazing robotics projects from our community</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, var(--accent), #0891b2);">
                    <i class="fas fa-comments"></i>
                </div>
            </div>
            <h4 class="feature-title">
                <a href="{{ url_for('student_projects.student_projects') }}" style="text-decoration: none; color: inherit;">Community Forum</a>
            </h4>
            <p class="feature-description">Connect, share ideas, and collaborate with fellow makers</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-header">
                <div class="feature-icon" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                    <i class="fas fa-headset"></i>
                </div>
            </div>
            <h4 class="feature-title">
                <a href="{{ url_for('main.about') }}" style="text-decoration: none; color: inherit;">24/7 Support</a>
            </h4>
            <p class="feature-description">Get help whenever you need it from our expert team</p>
        </div>
    </div>
</div>

<!-- Success Stories & Testimonials -->
<section class="section-padding">
    <div class="container">
        <h2 class="section-title">Success Stories & Testimonials</h2>
        <p class="section-subtitle">Hear from our students and their achievements</p>
        
        <div class="testimonials-grid">
            <!-- Testimonial 1 -->
            <div class="testimonial-card">
                <div class="testimonial-content">
                    <div class="testimonial-avatar">
                        <img src="https://res.cloudinary.com/dfizb64hx/image/upload/v1600x1600/avatar1.jpg" alt="Student 1">
                    </div>
                    <div class="testimonial-text">
                        <p>"The robotics program transformed my child's understanding of technology. He built his first robot in just 2 months!"</p>
                        <div class="testimonial-author">- Sarah M., Parent</div>
                    </div>
                </div>
                <div class="testimonial-stats">
                    <span><i class="fas fa-trophy"></i> 1st Place - Regional Robotics</span>
                    <span><i class="fas fa-chart-line"></i> 6 months progress</span>
                </div>
            </div>

            <!-- Testimonial 2 -->
            <div class="testimonial-card">
                <div class="testimonial-content">
                    <div class="testimonial-avatar">
                        <img src="https://res.cloudinary.com/dfizb64hx/image/upload/v1600x1600/avatar2.jpg" alt="Student 2">
                    </div>
                    <div class="testimonial-text">
                        <p>"I never thought I could code, but the projects made it so easy to learn. Now I've built my own app!"</p>
                        <div class="testimonial-author">- James L., Student</div>
                    </div>
                </div>
                <div class="testimonial-stats">
                    <span><i class="fas fa-code"></i> Built 3 apps</span>
                    <span><i class="fas fa-star"></i> 5/5 Rating</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Student Achievements -->
<section class="section-padding bg-light">
    <div class="container">
        <h2 class="section-title">Student Achievements</h2>
        <p class="section-subtitle">Celebrating our students' success</p>
        
        <div class="achievements-grid">
            <div class="achievement-card">
                <i class="fas fa-users"></i>
                <h3>500+</h3>
                <p>Students Enrolled</p>
            </div>
            <div class="achievement-card">
                <i class="fas fa-trophy"></i>
                <h3>25+</h3>
                <p>Competitions Won</p>
            </div>
            <div class="achievement-card">
                <i class="fas fa-laptop-code"></i>
                <h3>100+</h3>
                <p>Projects Completed</p>
            </div>
            <div class="achievement-card">
                <i class="fas fa-star"></i>
                <h3>4.9/5</h3>
                <p>Average Rating</p>
            </div>
        </div>
    </div>
</section>

<!-- Featured YouTube Videos -->
<section class="section-padding">
    <div class="container">
        <h2 class="section-title">Featured Projects</h2>
        <p class="section-subtitle">See what our students have built</p>
        
        <div class="videos-grid">
            <div class="video-card">
                <div class="video-wrapper">
                    <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="Student Project 1" frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen></iframe>
                </div>
                <h3>Autonomous Robot</h3>
                <p>Built by Alex, Age 14</p>
            </div>
            
            <div class="video-card">
                <div class="video-wrapper">
                    <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="Student Project 2" frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen></iframe>
                </div>
                <h3>Smart Home System</h3>
                <p>Built by Jamie, Age 16</p>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <a href="{{ url_for('student_projects.student_projects') }}" class="btn btn-primary">View All Projects</a>
        </div>
    </div>
</section>

<!-- Floating Action Button -->
<button class="fab" onclick="openChatModal()" aria-label="Open AI Assistant">
    <i class="fas fa-robot"></i>
</button>

<!-- Mobile-Optimized Chat Modal -->
<div class="chat-modal" id="chatModal">
    <div class="chat-content">
        <button class="chat-close" onclick="closeChatModal()" aria-label="Close chat">&times;</button>
        <h3 style="margin-bottom: 16px; font-size: 18px;">Contact Our AI Assistant</h3>
        <form class="chat-form" id="chatForm">
            <input type="email" name="email" placeholder="Your Email" required class="chat-input">
            <input type="tel" name="whatsapp" placeholder="WhatsApp Number" required class="chat-input">
            <textarea name="message" placeholder="How can we help you today?" required class="chat-input chat-textarea"></textarea>
            <button type="submit" class="chat-submit">Send Message</button>
            <div class="chat-status" id="chatFormStatus"></div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Performance optimization - Intersection Observer for animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -20px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
                observer.unobserve(entry.target); // Stop observing once animated
            }
        });
    }, observerOptions);

    // Animate cards on scroll
    document.querySelectorAll('.category-card, .feature-card, .stat-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
    });

    // Enhanced search functionality
    const searchInput = document.getElementById('globalSearch');
    const searchResults = document.getElementById('searchResults');
    const searchLoading = document.getElementById('searchLoading');
    const searchContent = document.getElementById('searchContent');
    const voiceBtn = document.querySelector('.voice-search');
    
    let searchTimeout;
    let isSearching = false;

    // Voice search with better mobile support
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';
        
        voiceBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (navigator.vibrate) navigator.vibrate(10);
            
            voiceBtn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
            voiceBtn.style.background = 'rgba(239, 68, 68, 0.3)';
            recognition.start();
        });
        
        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            searchInput.value = transcript;
            performSearch(transcript);
            resetVoiceButton();
        };
        
        recognition.onerror = resetVoiceButton;
        recognition.onend = resetVoiceButton;
        
        function resetVoiceButton() {
            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            voiceBtn.style.background = 'rgba(255, 255, 255, 0.2)';
        }
    } else {
        voiceBtn.style.display = 'none';
    }
    
    // Optimized search with debouncing
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        const query = this.value.trim();
        
        if (query.length === 0) {
            hideSearchResults();
            return;
        }
        
        if (query.length < 2) {
            return;
        }
        
        searchTimeout = setTimeout(() => {
            if (!isSearching) {
                performSearch(query);
            }
        }, 300);
    });

    searchInput.addEventListener('focus', function() {
        if (this.value.trim().length >= 2) {
            showSearchResults();
        }
    });
    
    // Enhanced touch handling for mobile
    let touchStartY = 0;
    document.addEventListener('touchstart', function(e) {
        touchStartY = e.touches[0].clientY;
        
        // Hide search results when touching outside
        if (!e.target.closest('.search-container')) {
            hideSearchResults();
        }
    });
    
    document.addEventListener('touchmove', function(e) {
        // Prevent zoom on double tap for better UX
        if (e.touches.length > 1) {
            e.preventDefault();
        }
    }, { passive: false });
    
    function performSearch(query) {
        if (isSearching) return;
        
        isSearching = true;
        showSearchLoading();
        
        // Haptic feedback for mobile
        if (navigator.vibrate) {
            navigator.vibrate([10]);
        }
        
        fetch('/api/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ query: query })
        })
        .then(response => {
            if (!response.ok) throw new Error('Search failed');
            return response.json();
        })
        .then(data => {
            hideSearchLoading();
            displaySearchResults(data);
        })
        .catch(error => {
            hideSearchLoading();
            console.error('Search error:', error);
            displayNoResults();
        })
        .finally(() => {
            isSearching = false;
        });
    }
    
    function showSearchLoading() {
        searchResults.classList.add('show');
        searchLoading.style.display = 'flex';
        searchContent.style.display = 'none';
    }
    
    function hideSearchLoading() {
        searchLoading.style.display = 'none';
        searchContent.style.display = 'block';
    }
    
    function showSearchResults() {
        searchResults.classList.add('show');
    }
    
    function hideSearchResults() {
        searchResults.classList.remove('show');
    }
    
    function displaySearchResults(data) {
        let html = '';
        
        // Process search results with mobile-optimized display
        const categories = [
            { key: 'individual_classes', title: 'Individual Classes', icon: 'fas fa-user', baseUrl: '/class/individual/' },
            { key: 'group_classes', title: 'Group Classes', icon: 'fas fa-users', baseUrl: '/class/group/' },
            { key: 'courses', title: 'Courses', icon: 'fas fa-graduation-cap', baseUrl: '/course/' },
            { key: 'products', title: 'Products', icon: 'fas fa-cube', baseUrl: '/product/' },
            { key: 'projects', title: 'Student Projects', icon: 'fas fa-lightbulb', baseUrl: '/projects/' },
            { key: 'users', title: 'People', icon: 'fas fa-user', baseUrl: '/profile/' },
            { key: 'materials', title: 'Materials', icon: 'fas fa-file-alt', baseUrl: '/materials/' },
            { key: 'robotics_submissions', title: 'Robotics Projects', icon: 'fas fa-robot', baseUrl: '/robotics-projects/' }
        ];
        
        categories.forEach(category => {
            if (data[category.key] && data[category.key].length > 0) {
                html += `<div class="search-section">`;
                html += `<div class="search-section-title">${category.title}</div>`;
                
                data[category.key].slice(0, 5).forEach(item => { // Limit to 5 items for mobile
                    const title = item.name || item.title || item.project_title || `${item.first_name} ${item.last_name}` || 'Unknown';
                    const subtitle = getItemSubtitle(item, category.key);
                    const price = getItemPrice(item, category.key);
                    
                    html += `
                        <a href="${category.baseUrl}${item.id}" class="search-item">
                            <div class="search-item-icon ${category.key}">
                                <i class="${category.icon}"></i>
                            </div>
                            <div class="search-item-content">
                                <div class="search-item-title">${title}</div>
                                <div class="search-item-subtitle">${subtitle}</div>
                            </div>
                            <div class="search-item-price">${price}</div>
                        </a>
                    `;
                });
                html += '</div>';
            }
        });
        
        if (html === '') {
            displayNoResults();
            return;
        }
        
        searchContent.innerHTML = html;
        showSearchResults();
        
        // Add smooth scroll for search results on mobile
        searchResults.scrollTop = 0;
    }
    
    function getItemSubtitle(item, category) {
        switch(category) {
            case 'individual_classes':
                return `Individual Class  ${item.teacher_name || 'Expert Instructor'}`;
            case 'group_classes':
                return `Group Class  Max ${item.max_students || 10} students`;
            case 'courses':
                return `${item.category}  ${item.level || 'Beginner'}`;
            case 'products':
                return `${item.category}  ${item.product_type || 'Physical'}`;
            case 'projects':
                return `By ${item.student_name}  ${item.like_count || 0} likes`;
            case 'users':
                return `${item.is_admin ? 'Instructor' : 'Student'}  Joined ${item.join_date || 'Recently'}`;
            case 'materials':
                return `${item.class_type} Class  By ${item.creator_name}`;
            case 'robotics_submissions':
                return `By ${item.name}  ${item.status}`;
            default:
                return 'TechBuxin';
        }
    }
    
    function getItemPrice(item, category) {
        switch(category) {
            case 'individual_classes':
                return '$100';
            case 'group_classes':
                return 'D1000';
            case 'courses':
                return item.price || 'Free';
            case 'products':
                return item.price || 'Contact';
            case 'projects':
                return item.featured ? 'Featured' : 'Project';
            case 'users':
                return item.is_admin ? 'Teacher' : 'Student';
            case 'materials':
                return 'Material';
            case 'robotics_submissions':
                return item.education_level || 'Project';
            default:
                return '';
        }
    }
    
    function displayNoResults() {
        searchContent.innerHTML = `
            <div class="no-results">
                <i class="fas fa-search" style="font-size: 32px; margin-bottom: 12px; opacity: 0.5;"></i>
                <p style="margin-bottom: 4px;">No results found</p>
                <small>Try searching for classes, courses, or projects</small>
            </div>
        `;
        showSearchResults();
    }
    
    // Mobile-optimized chat modal functions
    window.openChatModal = function() {
        const modal = document.getElementById('chatModal');
        modal.classList.add('show');
        document.body.style.overflow = 'hidden'; // Prevent background scroll
        
        // Focus first input for better UX
        setTimeout(() => {
            modal.querySelector('input[name="email"]').focus();
        }, 100);
    };
    
    window.closeChatModal = function() {
        const modal = document.getElementById('chatModal');
        modal.classList.remove('show');
        document.body.style.overflow = ''; // Restore scroll
    };
    
    // Enhanced form submission with loading states
    document.getElementById('chatForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const form = this;
        const status = document.getElementById('chatFormStatus');
        const submitBtn = form.querySelector('.chat-submit');
        const originalText = submitBtn.textContent;
        
        // Show loading state
        submitBtn.innerHTML = '<div class="loading-spinner" style="margin: 0 auto;"></div>';
        submitBtn.disabled = true;
        status.textContent = '';
        
        // Haptic feedback
        if (navigator.vibrate) navigator.vibrate(10);
        
        const formData = {
            email: form.email.value,
            whatsapp: form.whatsapp.value,
            message: form.message.value
        };
        
        fetch('/contact-support', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                status.style.color = 'var(--success)';
                status.textContent = 'Message sent! We\'ll reply soon.';
                form.reset();
                
                // Success haptic feedback
                if (navigator.vibrate) navigator.vibrate([50, 50, 50]);
            } else {
                throw new Error(data.message || 'Failed to send message');
            }
        })
        .catch(error => {
            status.style.color = 'var(--danger)';
            status.textContent = 'Failed to send. Please try again.';
            console.error('Contact form error:', error);
            
            // Error haptic feedback
            if (navigator.vibrate) navigator.vibrate([100, 100, 100]);
        })
        .finally(() => {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        });
    });
    
    // Enhanced touch interactions for cards
    document.querySelectorAll('.category-card, .feature-card, .stat-card').forEach(card => {
        let touchStartTime;
        let touchStartPos;
        
        card.addEventListener('touchstart', function(e) {
            touchStartTime = Date.now();
            touchStartPos = {
                x: e.touches[0].clientX,
                y: e.touches[0].clientY
            };
            
            this.style.transform = 'scale(0.98)';
            this.style.transition = 'transform 0.1s ease';
        });
        
        card.addEventListener('touchend', function(e) {
            const touchEndTime = Date.now();
            const touchDuration = touchEndTime - touchStartTime;
            
            this.style.transform = '';
            this.style.transition = 'transform 0.3s ease';
            
            // If it's a quick tap (less than 200ms), treat as click
            if (touchDuration < 200) {
                const link = this.getAttribute('href');
                if (link) {
                    // Add small delay for visual feedback
                    setTimeout(() => {
                        window.location.href = link;
                    }, 100);
                }
            }
        });
        
        card.addEventListener('touchcancel', function() {
            this.style.transform = '';
            this.style.transition = 'transform 0.3s ease';
        });
    });
    
    // Optimized scroll performance
    let ticking = false;
    
    function updateOnScroll() {
        // Minimal scroll operations here if needed
        ticking = false;
    }
    
    window.addEventListener('scroll', function() {
        if (!ticking) {
            requestAnimationFrame(updateOnScroll);
            ticking = true;
        }
    }, { passive: true });
    
    // Enhanced button interactions with loading states
    document.querySelectorAll('.cta-button').forEach(btn => {
        btn.addEventListener('click', function(e) {
            // Prevent double clicks
            if (this.classList.contains('loading')) {
                e.preventDefault();
                return;
            }
            
            /* New Sections Styles */
    .section-padding {
        padding: 4rem 0;
            // Haptic feedback
            if (navigator.vibrate) {
                navigator.vibrate(10);
            }
            
            // Allow natural navigation after brief delay
            setTimeout(() => {
                if (this.href && !e.defaultPrevented) {
                    window.location.href = this.href;
                }
            }, 500);
        });
    });
    
    // Preload critical resources for better performance
    const importantLinks = [
        'https://www.techbuxin.com/classes',
        'https://www.techbuxin.com/student-projects',
        'https://www.techbuxin.com/products',
        'https://www.techbuxin.com/ai_assistant'
    ];
    
    // Preload links when user hovers/touches (on mobile)
    document.querySelectorAll('.category-card').forEach((card, index) => {
        const href = card.getAttribute('href');
        if (href && importantLinks.includes(href)) {
            const link = document.createElement('link');
            link.rel = 'prefetch';
            link.href = href;
            document.head.appendChild(link);
        }
    });
    
    // Service Worker registration for offline capability (optional)
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/sw.js')
                .then(function(registration) {
                    console.log('SW registered: ', registration);
                })
                .catch(function(registrationError) {
                    console.log('SW registration failed: ', registrationError);
                });
        });
    }
    
    // Enhanced keyboard navigation for accessibility
    document.addEventListener('keydown', function(e) {
        // Close modal with Escape key
        if (e.key === 'Escape') {
            const modal = document.getElementById('chatModal');
            if (modal.classList.contains('show')) {
                closeChatModal();
            }
            hideSearchResults();
        }
        
        // Open search with Ctrl/Cmd + K
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            searchInput.focus();
        }
    });
    
    // Handle connection status for better UX
    function updateConnectionStatus() {
        if (navigator.onLine) {
            document.body.classList.remove('offline');
        } else {
            document.body.classList.add('offline');
            // Show offline indicator
            const offlineMsg = document.createElement('div');
            offlineMsg.className = 'offline-indicator';
            offlineMsg.innerHTML = '<i class="fas fa-wifi"></i> You\'re offline';
            offlineMsg.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--warning);
                color: white;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 14px;
                z-index: 9999;
                animation: slideDown 0.3s ease;
            `;
            document.body.appendChild(offlineMsg);
            
            setTimeout(() => {
                if (offlineMsg.parentNode) {
                    offlineMsg.remove();
                }
            }, 3000);
        }
    }
    
    window.addEventListener('online', updateConnectionStatus);
    window.addEventListener('offline', updateConnectionStatus);
    
    // Add iOS-style pull-to-refresh (optional)
    let startY = 0;
    let currentY = 0;
    let pullDistance = 0;
    const maxPull = 100;
    
    document.addEventListener('touchstart', function(e) {
        if (window.scrollY === 0) {
            startY = e.touches[0].clientY;
        }
    }, { passive: true });
    
    document.addEventListener('touchmove', function(e) {
        if (window.scrollY === 0 && startY) {
            currentY = e.touches[0].clientY;
            pullDistance = Math.min(currentY - startY, maxPull);
            
            if (pullDistance > 0) {
                const heroSection = document.querySelector('.hero-section');
                heroSection.style.transform = `translateY(${pullDistance * 0.5}px)`;
                heroSection.style.opacity = 1 - (pullDistance / maxPull) * 0.1;
            }
        }
    }, { passive: true });
    
    document.addEventListener('touchend', function() {
        const heroSection = document.querySelector('.hero-section');
        heroSection.style.transform = '';
        heroSection.style.opacity = '';
        heroSection.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
        
        setTimeout(() => {
            heroSection.style.transition = '';
        }, 300);
        
        if (pullDistance > 60) {
            // Trigger refresh action
            if (navigator.vibrate) navigator.vibrate(50);
            window.location.reload();
        }
        
        startY = 0;
        pullDistance = 0;
    });
    
    // Optimize images for mobile with lazy loading
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        imageObserver.unobserve(img);
                    }
                }
            });
        });
        
        // Observe robot arm images
        document.querySelectorAll('.robot-arm img').forEach(img => {
            imageObserver.observe(img);
        });
    }
    
    console.log('TechBuxin Mobile App initialized successfully! ');
});

// Add slideDown animation for offline indicator
const additionalStyles = `
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateX(-50%) translateY(-100%);
        }
        to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    }
    
    .offline {
        filter: grayscale(20%);
    }
    
    .offline .search-bar {
        opacity: 0.7;
        pointer-events: none;
    }
    
    .loading {
        opacity: 0.7;
        cursor: not-allowed !important;
    }
    
    /* Additional mobile performance optimizations */
    .hero-bg-pattern {
        will-change: transform;
        transform: translateZ(0);
    }
    
    .robot-arm {
        will-change: transform;
        transform: translateZ(0);
    }
    
    /* Better text rendering on mobile */
    body {
        text-rendering: optimizeLegibility;
        -webkit-font-feature-settings: "kern" 1;
        font-feature-settings: "kern" 1;
    }
    
    /* Improve scrolling performance */
    * {
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
    }
    
    .main-content,
    .hero-section,
    .stats-section {
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
    }
`;

const styleSheet = document.createElement('style');
styleSheet.textContent = additionalStyles;
document.head.appendChild(styleSheet);
</script>

<!-- Add CSS for search item icon colors -->
<style>
.search-item-icon.individual_classes { background: linear-gradient(135deg, #ef4444, #dc2626); }
.search-item-icon.group_classes { background: linear-gradient(135deg, #ef4444, #dc2626); }
.search-item-icon.courses { background: linear-gradient(135deg, var(--primary-solid), var(--secondary)); }
.search-item-icon.products { background: linear-gradient(135deg, var(--accent), #0891b2); }
.search-item-icon.projects { background: linear-gradient(135deg, var(--success), #059669); }
.search-item-icon.users { background: linear-gradient(135deg, #ec4899, #db2777); }
.search-item-icon.materials { background: linear-gradient(135deg, var(--warning), #d97706); }
.search-item-icon.robotics_submissions { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }

.search-section {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
}

.search-section:last-child {
    border-bottom: none;
}

.search-section-title {
    font-size: 12px;
    font-weight: 700;
    color: var(--gray);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
    padding-left: 4px;
}

.no-results {
    text-align: center;
    padding: 32px 20px;
    color: var(--gray);
}
</style>

<!-- Mobile Bottom Navigation -->
<nav class="bottom-nav">
    <div class="bottom-nav-content">
        <a href="{{ url_for('main.index') }}" class="nav-item active">
            <i class="fas fa-home nav-icon"></i>
            <span class="nav-label">Home</span>
        </a>
        
        <a href="{{ url_for('store.store') }}" class="nav-item">
            <i class="fas fa-video nav-icon"></i>
            <span class="nav-label">Classes</span>
            <div class="nav-badge">Live</div>
        </a>
        
        <a href="{{ url_for('store.store') }}" class="nav-item">
            <i class="fas fa-graduation-cap nav-icon"></i>
            <span class="nav-label">Courses</span>
        </a>
        
        <a href="{{ url_for('student_projects.student_projects') }}" class="nav-item">
            <i class="fas fa-shopping-cart nav-icon"></i>
            <span class="nav-label">Projects</span>
        </a>
        
        <a href="{{ url_for('integrations.ai_assistant') }}" class="nav-item">
            <i class="fas fa-robot nav-icon"></i>
            <span class="nav-label">AI Help</span>
        </a>
    </div>
</nav>

<!-- Safe Area Handling for Modern Devices -->
<script>
// Safe area handling for devices with notches
if (CSS.supports('padding: max(0px)')) {
    document.documentElement.style.setProperty('--safe-area-inset-bottom', 'env(safe-area-inset-bottom)');
}
</script>

{% endblock %}


