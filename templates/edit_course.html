{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header bg-warning">
                    <h4>‚úèÔ∏è Edit Course: {{ course.title }}</h4>
                </div>
                <div class="card-body">
                    <!-- Update Course Form -->
                    <form method="POST" action="{{ url_for('edit_course', course_id=course.id) }}">
                        <div class="mb-3">
                            <label class="form-label">Course Title *</label>
                            <input type="text" class="form-control" name="title" value="{{ course.title }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Price (GMD) *</label>
                            <input type="number" class="form-control" name="price" step="0.01" value="{{ course.price }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Short Description</label>
                            <input type="text" class="form-control" name="short_description" value="{{ course.short_description or '' }}">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" name="description" rows="4" required>{{ course.description }}</textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Category *</label>
                                <select class="form-select" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="Artificial Intelligence" {% if course.category == 'Artificial Intelligence' %}selected{% endif %}>AI</option>
                                    <option value="Machine Learning" {% if course.category == 'Machine Learning' %}selected{% endif %}>Machine Learning</option>
                                    <option value="Programming" {% if course.category == 'Programming' %}selected{% endif %}>Programming</option>
                                    <option value="Web Development" {% if course.category == 'Web Development' %}selected{% endif %}>Web Development</option>
                                    <option value="Electronics Engineering" {% if course.category == 'Electronics Engineering' %}selected{% endif %}>Electronics</option>
                                    <option value="Robotics" {% if course.category == 'Robotics' %}selected{% endif %}>Robotics</option>
                                    <option value="Other" {% if course.category == 'Other' %}selected{% endif %}>Other</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Level *</label>
                                <select class="form-select" name="level" required>
                                    <option value="">Select Level</option>
                                    <option value="Beginner" {% if course.level == 'Beginner' %}selected{% endif %}>Beginner</option>
                                    <option value="Intermediate" {% if course.level == 'Intermediate' %}selected{% endif %}>Intermediate</option>
                                    <option value="Advanced" {% if course.level == 'Advanced' %}selected{% endif %}>Advanced</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Duration (weeks)</label>
                                <input type="number" class="form-control" name="duration_weeks" value="{{ course.duration_weeks }}" min="1">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Image URL</label>
                                <input type="url" class="form-control" name="image_url" value="{{ course.image_url or '' }}">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="is_active" {% if course.is_active %}checked{% endif %}>
                                    <label class="form-check-label">Active (visible in store)</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="featured" {% if course.featured %}checked{% endif %}>
                                    <label class="form-check-label">Featured course</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-warning">üíæ Update Course</button>
                            <a href="{{ url_for('admin_courses') }}" class="btn btn-secondary">‚Üê Back</a>
                            <a href="{{ url_for('course_detail', course_id=course.id) }}" class="btn btn-outline-primary" target="_blank">üëÅÔ∏è Preview</a>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Videos Section -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5>üé¨ Videos ({{ course.videos|length }})</h5>
                </div>
                <div class="card-body">
                    {% if course.videos %}
                        {% for video in course.videos %}
                            <div class="border p-3 mb-2 rounded">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>{{ loop.index }}. {{ video.title }}</strong>
                                        {% if video.duration %}<small class="text-muted"> - {{ video.duration }}</small>{% endif %}
                                    </div>
                                    <div>
                                        {% if video.video_url %}
                                            <a href="{{ video.video_url }}" target="_blank" class="btn btn-sm btn-primary">Play</a>
                                        {% else %}
                                            <a href="{{ url_for('course_video', filename=video.video_filename) }}" target="_blank" class="btn btn-sm btn-primary">Play</a>
                                        {% endif %}
                                        <button onclick="deleteVideo({{ video.id }})" class="btn btn-sm btn-danger">Delete</button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">No videos uploaded yet.</p>
                    {% endif %}
                    
                    <!-- Simple Add Video -->
                    <button onclick="showVideoForm()" class="btn btn-success">+ Add Video</button>
                    
                    <div id="videoForm" style="display:none;" class="mt-3 p-3 border rounded">
                        <form action="/admin/add_video_to_course" method="POST" enctype="multipart/form-data">
                            <input type="hidden" name="course_id" value="{{ course.id }}">
                            <div class="mb-2">
                                <input type="text" class="form-control" name="video_title" placeholder="Video Title" required>
                            </div>
                            <div class="mb-2">
                                <input type="file" class="form-control" name="video_file" accept="video/*" required>
                            </div>
                            <div class="mb-2">
                                <input type="text" class="form-control" name="video_duration" placeholder="Duration (e.g. 10:30)">
                            </div>
                            <button type="submit" class="btn btn-success">Upload</button>
                            <button type="button" onclick="hideVideoForm()" class="btn btn-secondary">Cancel</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Materials Section -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5>üìÅ Materials ({{ course.materials|length }})</h5>
                </div>
                <div class="card-body">
                    {% if course.materials %}
                        {% for material in course.materials %}
                            <div class="border p-2 mb-2 rounded d-flex justify-content-between align-items-center">
                                <span>{{ material.title }} <small class="text-muted">({{ material.file_type.upper() }})</small></span>
                                <div>
                                    <a href="{{ url_for('course_material', filename=material.filename) }}" target="_blank" class="btn btn-sm btn-primary">Download</a>
                                    <button onclick="deleteMaterial({{ material.id }})" class="btn btn-sm btn-danger">Delete</button>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">No materials uploaded yet.</p>
                    {% endif %}
                    
                    <!-- Simple Add Material -->
                    <button onclick="showMaterialForm()" class="btn btn-success">+ Add Material</button>
                    
                    <div id="materialForm" style="display:none;" class="mt-3 p-3 border rounded">
                        <form action="/admin/add_material_to_course" method="POST" enctype="multipart/form-data">
                            <input type="hidden" name="course_id" value="{{ course.id }}">
                            <div class="mb-2">
                                <input type="text" class="form-control" name="material_title" placeholder="Material Title" required>
                            </div>
                            <div class="mb-2">
                                <input type="file" class="form-control" name="material_file" accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.zip" required>
                            </div>
                            <button type="submit" class="btn btn-success">Upload</button>
                            <button type="button" onclick="hideMaterialForm()" class="btn btn-secondary">Cancel</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Delete Course -->
            {% if course.get_enrolled_count() == 0 %}
            <div class="card mt-4 border-danger">
                <div class="card-body text-center">
                    <h6 class="text-danger">Danger Zone</h6>
                    <form action="{{ url_for('delete_course', course_id=course.id) }}" method="POST" onsubmit="return confirm('Delete this course forever?')">
                        <button type="submit" class="btn btn-danger">üóëÔ∏è Delete Course</button>
                    </form>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Super simple JavaScript - no complexity!

function showVideoForm() {
    document.getElementById('videoForm').style.display = 'block';
}

function hideVideoForm() {
    document.getElementById('videoForm').style.display = 'none';
}

function showMaterialForm() {
    document.getElementById('materialForm').style.display = 'block';
}

function hideMaterialForm() {
    document.getElementById('materialForm').style.display = 'none';
}

function deleteVideo(videoId) {
    if (confirm('Delete this video?')) {
        fetch('/admin/delete_video/' + videoId, {method: 'POST'})
        .then(() => location.reload());
    }
}

function deleteMaterial(materialId) {
    if (confirm('Delete this material?')) {
        fetch('/admin/delete_material/' + materialId, {method: 'POST'})
        .then(() => location.reload());
    }
}
</script>
{% endblock %}


