<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waiting for Approval - Buxin Future Academy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --robotics-primary: #00d4ff;
            --robotics-secondary: #ff6b35;
            --robotics-accent: #39ff14;
            --robotics-dark: #0a0a1a;
            --surface-solid: rgba(5, 5, 16, 0.9);
            --border: rgba(0, 212, 255, 0.3);
            --on-surface: #e0e0e0;
        }

        body {
            background: var(--robotics-dark);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--on-surface);
            margin: 0;
            padding: 0;
        }
        
        /* Top Navigation Bar */
        .top-nav {
            background: rgba(10, 10, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
            padding: 0.75rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: var(--robotics-primary);
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .nav-brand:hover {
            color: var(--robotics-primary);
            text-decoration: none;
        }
        
        .nav-brand img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid var(--robotics-primary);
        }
        
        .nav-signout {
            color: var(--on-surface);
            text-decoration: none;
            font-size: 0.95rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .nav-signout:hover {
            background: rgba(0, 212, 255, 0.1);
            color: var(--robotics-primary);
        }

        .approval-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 70px);
            padding: 2rem;
        }

        .approval-card {
            background: var(--surface-solid);
            border: 2px solid var(--border);
            border-radius: 25px;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            text-align: center;
            box-shadow: 0 0 50px rgba(0, 212, 255, 0.2);
        }

        .approval-icon {
            font-size: 5rem;
            color: var(--robotics-primary);
            animation: pulse 2s infinite;
            margin-bottom: 2rem;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .approval-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--robotics-primary);
            margin-bottom: 1rem;
        }

        .enrollment-info {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: left;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        .info-value {
            color: white;
            font-weight: 600;
        }

        .status-badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            color: #ffc107;
            font-weight: 600;
            margin: 1rem 0;
        }

        .spinner {
            border: 3px solid rgba(0, 212, 255, 0.3);
            border-top: 3px solid var(--robotics-primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .message {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin: 1.5rem 0;
        }
        
        @media (max-width: 768px) {
            .top-nav {
                padding: 0.75rem 1rem;
            }
            
            .approval-card {
                padding: 2rem 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <a class="nav-brand" href="javascript:void(0);" onclick="window.location.reload(); return false;">
            <img src="https://res.cloudinary.com/dfizb64hx/image/upload/v1753480189/Untvvvvitled-1_i2iduk.png" alt="Logo">
            <span>BuXin Academy</span>
        </a>
        <a class="nav-signout" href="{{ url_for('main.index') }}">
            <i class="fas fa-home me-1"></i>Home
        </a>
    </nav>
    
    <div class="approval-container">
        <div class="approval-card">
            <div class="approval-icon">
                <i class="fas fa-clock"></i>
            </div>
            
            <h2 class="approval-title">Waiting for Approval</h2>
            
            {% if enrollment %}
            <div class="enrollment-info">
                <div class="info-item">
                    <span class="info-label">Student Name:</span>
                    <span class="info-value">{{ enrollment.customer_name }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Class Type:</span>
                    <span class="info-value">{{ enrollment.class_type|title }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Amount Paid:</span>
                    <span class="info-value">${{ enrollment.amount|int }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Payment Method:</span>
                    <span class="info-value">{{ enrollment.payment_method|title }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Registration Date:</span>
                    <span class="info-value">{{ enrollment.enrolled_at.strftime('%B %d, %Y') if enrollment.enrolled_at else 'N/A' }}</span>
                </div>
            </div>
            {% endif %}
            
            <div class="status-badge">
                <i class="fas fa-hourglass-half me-2"></i>Pending Approval
            </div>
            
            <p class="message">
                Your registration has been submitted successfully and your payment receipt has been received.
                Our admin team is reviewing your payment. You will receive your Student ID via email once your payment is approved.
            </p>
            
            <div style="background: rgba(0, 212, 255, 0.1); border: 1px solid var(--border); border-radius: 15px; padding: 1.5rem; margin: 2rem 0; text-align: center;">
                <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 1rem; font-size: 1rem;">
                    <strong>Already paid?</strong> Contact us via WhatsApp or Email to get your Student ID card and access to your class!
                </p>
                <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 1.5rem; font-size: 0.9rem;">
                    Text me on WhatsApp or send an email. I can send you your Student ID card and approve your class.
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    {% if whatsapp_number_clean %}
                    <a href="https://wa.me/{{ whatsapp_number_clean }}" target="_blank" 
                       style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); color: white; text-decoration: none; border-radius: 25px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);">
                        <i class="fab fa-whatsapp" style="font-size: 1.2rem;"></i>
                        WhatsApp
                    </a>
                    {% endif %}
                    {% set email_address = contact_email if contact_email else 'worldvlog13@gmail.com' %}
                    <a href="#" 
                       class="show-email-btn"
                       data-email="{{ email_address }}"
                       style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #00a8ff 0%, #0077b6 100%); color: white; text-decoration: none; border-radius: 25px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0, 168, 255, 0.3); cursor: pointer;">
                        <i class="fas fa-envelope" style="font-size: 1.2rem;"></i>
                        Email
                    </a>
                </div>
            </div>
            
            <div class="spinner"></div>
            
            <p style="color: rgba(255, 255, 255, 0.5); font-size: 0.9rem; margin-top: 2rem;">
                <i class="fas fa-info-circle me-2"></i>
                This page will automatically update once your registration is approved.
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Auto-refresh every 5 seconds to check approval status (faster detection)
    setInterval(function() {
        fetch(window.location.href, {
            method: 'GET',
            cache: 'no-cache',
            headers: {
                'Cache-Control': 'no-cache'
            }
        })
            .then(response => {
                // Check if we got redirected (status 302 or 200 with different content)
                if (response.redirected || response.status === 302) {
                    window.location.reload();
                    return;
                }
                return response.text();
            })
            .then(html => {
                if (!html) return;
                // Check if status changed (enrollment approved)
                // If page doesn't contain "Pending Approval" or contains redirect indicators
                if (!html.includes('Pending Approval') || 
                    html.includes('redirect') || 
                    html.includes('ID card') ||
                    html.includes('dashboard')) {
                    window.location.reload();
                }
            })
            .catch(() => {
                // Silently fail, will retry on next interval
            });
    }, 5000); // Check every 5 seconds instead of 30
    </script>

    <!-- Email Modal -->
    <div class="modal fade" id="emailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #0a0a1a; border: 1px solid rgba(0, 212, 255, 0.3);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">
                    <h5 class="modal-title" style="color: #00d4ff;">
                        <i class="fas fa-envelope me-2"></i>Contact Email
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center" style="padding: 2rem;">
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 1.5rem;">Copy our email address:</p>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="emailDisplay" readonly 
                               style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3); color: white; font-size: 1.1rem; text-align: center;">
                        <button class="btn btn-primary" type="button" id="copyEmailBtn" 
                                style="background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%); border: none;">
                            <i class="fas fa-copy me-2"></i>Copy
                        </button>
                    </div>
                    <p class="text-success" id="copySuccess" style="display: none; margin-top: 1rem;">
                        <i class="fas fa-check-circle me-2"></i>Email copied to clipboard!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Email button handler - show email in modal
        document.addEventListener('DOMContentLoaded', function() {
            const emailModal = new bootstrap.Modal(document.getElementById('emailModal'));
            
            document.querySelectorAll('.show-email-btn').forEach(function(btn) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const email = this.getAttribute('data-email');
                    if (email) {
                        document.getElementById('emailDisplay').value = email;
                        document.getElementById('copySuccess').style.display = 'none';
                        emailModal.show();
                    }
                });
            });
            
            // Copy email to clipboard
            document.getElementById('copyEmailBtn').addEventListener('click', function() {
                const emailInput = document.getElementById('emailDisplay');
                emailInput.select();
                emailInput.setSelectionRange(0, 99999);
                
                try {
                    navigator.clipboard.writeText(emailInput.value).then(function() {
                        document.getElementById('copySuccess').style.display = 'block';
                        setTimeout(function() {
                            document.getElementById('copySuccess').style.display = 'none';
                        }, 3000);
                    });
                } catch (err) {
                    document.execCommand('copy');
                    document.getElementById('copySuccess').style.display = 'block';
                    setTimeout(function() {
                        document.getElementById('copySuccess').style.display = 'none';
                    }, 3000);
                }
            });
        });
    </script>
</body>
</html>
