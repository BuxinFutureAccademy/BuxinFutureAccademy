{% extends "base.html" %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Course Header -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h3 class="card-title mb-2">{{ course.title }}</h3>
                            <p class="card-text">{{ course.short_description or course.description[:100] + '...' if course.description|length > 100 else course.description }}</p>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-light text-dark me-2">{{ course.category }}</span>
                                <span class="badge bg-success me-2">{{ course.level }}</span>
                                {% if videos and videos|length > 0 %}
                                    <span class="badge bg-warning text-dark">
                                        <i class="fas fa-play me-1"></i>{{ videos|length }} lessons
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <a href="{{ url_for('my_courses') }}" class="btn btn-light">
                                <i class="fas fa-arrow-left me-2"></i>Back to My Courses
                            </a>
                            {% if current_user.is_admin and debug_route_exists %}
                                <a href="{{ url_for('debug_course_videos', course_id=course.id) }}" class="btn btn-warning" target="_blank">
                                    <i class="fas fa-bug me-2"></i>Debug
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Course Content -->
        <div class="col-md-8">
            {% set available_videos = videos|selectattr('available', 'equalto', true)|list %}
            {% if videos and videos|length > 0 %}
                <!-- Video Player Section -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-play text-primary me-2"></i>
                            <span id="currentVideoTitle">
                                {% if available_videos|length > 0 %}
                                    {{ available_videos[0].title }}
                                {% else %}
                                    No videos available
                                {% endif %}
                            </span>
                        </h5>
                        <div>
                            <span class="badge bg-secondary" id="videoCounter">
                                {% if available_videos|length > 0 %}1 of {{ videos|length }}{% else %}0 of {{ videos|length }}{% endif %}
                            </span>
                            {% if current_user.is_admin and available_videos|length > 0 %}
                                <span class="badge bg-info ms-2" id="sourceTypeBadge">{{ available_videos[0].source_type }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="video-container">
                            {% if available_videos|length > 0 %}
                                <video id="courseVideo" class="w-100" controls style="max-height: 500px; background: #000;">
                                    <source src="{{ available_videos[0].playback_url }}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            {% else %}
                                <div class="alert alert-warning m-3">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>No Videos Available:</strong> 
                                    {% if videos|length > 0 %}
                                        Videos are being processed or are temporarily unavailable.
                                        {% if current_user.is_admin %}
                                            <br><small>Admin: Check the debug panel for more information.</small>
                                        {% endif %}
                                    {% else %}
                                        This course doesn't contain video lessons.
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    {% if available_videos|length > 0 %}
                        <div class="card-footer">
                            <div class="d-flex justify-content-between align-items-center">
                                <button class="btn btn-outline-secondary" id="prevBtn" disabled>
                                    <i class="fas fa-chevron-left me-2"></i>Previous
                                </button>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-primary" id="playPauseBtn">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" id="fullscreenBtn">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                                <button class="btn btn-primary" id="nextBtn">
                                    Next<i class="fas fa-chevron-right ms-2"></i>
                                </button>
                            </div>
                            <div class="mt-3">
                                <p class="text-muted mb-0" id="currentVideoDescription">
                                    {{ available_videos[0].description or "No description available." }}
                                </p>
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <!-- No Videos Message -->
                <div class="card mb-4">
                    <div class="card-body text-center">
                        <i class="fas fa-book fa-4x text-muted mb-3"></i>
                        <h4>Text-Based Course</h4>
                        <p class="text-muted">This course consists of reading materials and downloadable resources.</p>
                    </div>
                </div>
            {% endif %}

            <!-- Course Description -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle text-info me-2"></i>About This Course
                    </h5>
                </div>
                <div class="card-body">
                    <p>{{ course.description }}</p>
                    
                    {% if materials and materials|length > 0 %}
                        <h6 class="mt-4 mb-3">
                            <i class="fas fa-download text-warning me-2"></i>Course Materials
                        </h6>
                        <div class="row">
                            {% for material in materials %}
                                <div class="col-md-6 mb-2">
                                    <a href="{{ url_for('course_material', filename=material.filename) }}" 
                                       class="btn btn-outline-primary btn-sm w-100" target="_blank">
                                        <i class="fas fa-file-{{ material.file_type }} me-2"></i>{{ material.title }}
                                        <small class="text-muted">({{ material.get_file_size_mb() }} MB)</small>
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            No additional materials available for this course.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
            <!-- Progress Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-chart-line text-success me-2"></i>Your Progress
                    </h6>
                </div>
                <div class="card-body text-center">
                    <div class="progress-circle mb-3">
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" 
                                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="overallProgress"></div>
                        </div>
                    </div>
                    <h4 class="text-success" id="progressPercentage">0%</h4>
                    <p class="text-muted">Course Completed</p>
                    {% if available_videos|length > 0 %}
                        <small class="text-muted">
                            <span id="completedLessons">0</span> of {{ available_videos|length }} lessons completed
                        </small>
                    {% else %}
                        <small class="text-muted">
                            {% if videos|length > 0 %}
                                Videos being processed
                            {% else %}
                                Text-based course - read materials below
                            {% endif %}
                        </small>
                    {% endif %}
                </div>
            </div>

            <!-- Course Curriculum -->
            {% if videos and videos|length > 0 %}
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-list text-primary me-2"></i>Course Curriculum
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            {% for video in videos %}
                                <div class="list-group-item video-item 
                                     {% if not video.available %}list-group-item-secondary unavailable{% endif %}" 
                                     data-video-index="{{ loop.index0 }}"
                                     data-video-id="{{ video.id }}"
                                     data-available="{{ video.available|lower }}">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1">
                                                <span class="lesson-number">{{ loop.index }}.</span>
                                                {{ video.title }}
                                                {% if not video.available %}
                                                    <i class="fas fa-exclamation-triangle text-warning ms-2" 
                                                       title="Video not available"></i>
                                                {% endif %}
                                            </h6>
                                            {% if video.duration %}
                                                <small class="text-muted">
                                                    <i class="fas fa-clock me-1"></i>{{ video.duration }}
                                                </small>
                                            {% endif %}
                                            {% if current_user.is_admin %}
                                                <br><small class="text-muted">
                                                    Source: {{ video.source_type }}
                                                    {% if video.source_type == 'local' and not video.file_exists %}
                                                        <span class="text-danger">(file missing)</span>
                                                    {% elif video.source_type == 'cloudinary' %}
                                                        <span class="text-success">(cloud)</span>
                                                    {% elif video.source_type == 'none' %}
                                                        <span class="text-danger">(no source)</span>
                                                    {% endif %}
                                                </small>
                                            {% endif %}
                                        </div>
                                        <div class="lesson-status">
                                            {% if video.available %}
                                                <i class="fas fa-play text-muted"></i>
                                            {% else %}
                                                <i class="fas fa-times text-danger"></i>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="card">
                    <div class="card-body text-center">
                        <i class="fas fa-book fa-3x text-muted mb-3"></i>
                        <h6>Reading Materials</h6>
                        <p class="text-muted">This course consists of reading materials and downloadable resources.</p>
                        {% if materials and materials|length > 0 %}
                            <p class="text-success">{{ materials|length }} materials available for download</p>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Debug Info (Admin Only) -->
{% if current_user.is_admin and debug_info %}
<div class="container-fluid mt-4">
    <div class="card bg-light">
        <div class="card-header">
            <h6 class="mb-0">üîß Debug Info (Admin Only)</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <strong>Course ID:</strong> {{ course.id }}<br>
                    <strong>Total Videos:</strong> {{ debug_info.total_videos }}<br>
                    <strong>Available Videos:</strong> {{ available_videos|length }}<br>
                    <strong>Total Materials:</strong> {{ materials|length if materials else 0 }}
                </div>
                <div class="col-md-6">
                    <strong>Video Sources:</strong><br>
                    <ul class="small mb-0">
                        <li>Cloudinary: {{ debug_info.cloudinary_videos }}</li>
                        <li>Local: {{ debug_info.local_videos }}</li>
                        <li>Missing: {{ debug_info.missing_videos }}</li>
                        {% if debug_info.videos_with_missing_files > 0 %}
                            <li class="text-danger">Missing files: {{ debug_info.videos_with_missing_files }}</li>
                        {% endif %}
                    </ul>
                </div>
            </div>
            <div class="mt-3">
                {% if debug_route_exists %}
                    <a href="{{ url_for('debug_course_videos', course_id=course.id) }}" class="btn btn-sm btn-warning" target="_blank">
                        <i class="fas fa-bug me-1"></i>Detailed Debug
                    </a>
                {% endif %}
                <a href="{{ url_for('migrate_existing_videos') }}" class="btn btn-sm btn-info">
                    <i class="fas fa-cloud-upload-alt me-1"></i>Check Migration
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
.video-container {
    position: relative;
    background: #000;
}

.list-group-item.active {
    background-color: #0d6efd;
    border-color: #0d6efd;
}

.list-group-item:hover:not(.list-group-item-secondary) {
    background-color: #f8f9fa;
    cursor: pointer;
}

.list-group-item-secondary {
    opacity: 0.6;
    cursor: not-allowed;
}

.lesson-status .fa-check {
    color: #198754;
}

.lesson-status .fa-play {
    color: #0d6efd;
}

.lesson-status .fa-times {
    color: #dc3545;
}

.video-item.completed .lesson-status .fa-play {
    display: none;
}

.video-item.completed .lesson-status .fa-check {
    display: inline;
}

.video-item.current {
    background-color: #e3f2fd !important;
    border-left: 4px solid #2196f3 !important;
}

.video-item.unavailable {
    background-color: #f8f9fa !important;
    border-left: 4px solid #ffc107 !important;
}

.video-container.loading::before {
    content: "Loading video...";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 16px;
    z-index: 1;
    display: block;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üé¨ Initializing enhanced video player...');
    
    // Get DOM elements
    const video = document.getElementById('courseVideo');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const videoItems = document.querySelectorAll('.video-item');
    const currentVideoTitle = document.getElementById('currentVideoTitle');
    const currentVideoDescription = document.getElementById('currentVideoDescription');
    const videoCounter = document.getElementById('videoCounter');
    const sourceTypeBadge = document.getElementById('sourceTypeBadge');
    const videoContainer = document.querySelector('.video-container');
    
    // Get video data from template
    const videosData = {{ videos|tojson if videos else '[]' }};
    const totalVideos = videosData.length;
    const availableVideos = videosData.filter(v => v.available);
    
    console.log(`üìä Video Stats:`, {
        total: totalVideos,
        available: availableVideos.length,
        unavailable: totalVideos - availableVideos.length
    });
    
    let currentVideoIndex = 0;
    
    // Only initialize if we have video player and available videos
    if (video && availableVideos.length > 0) {
        console.log('‚úÖ Video player found, initializing...');
        
        // Find first available video index
        for (let i = 0; i < videosData.length; i++) {
            if (videosData[i].available) {
                currentVideoIndex = i;
                break;
            }
        }
        
        // Initialize video event listeners
        initializeVideoEvents();
        
        // Initialize UI event listeners
        initializeUIEvents();
        
        // Load first available video
        loadVideo(currentVideoIndex);
        
        // Load saved progress
        loadProgress();
        
        console.log('‚úÖ Video player initialized successfully');
    } else if (totalVideos === 0) {
        console.log('üìö Text-based course - no videos to load');
    } else {
        console.log('‚ö†Ô∏è No available videos found');
        showNotification('Videos are being processed. Please check back later.', 'info');
    }
    
    function initializeVideoEvents() {
        video.addEventListener('loadstart', function() {
            if (videoContainer) videoContainer.classList.add('loading');
            console.log('üîÑ Video loading started');
        });
        
        video.addEventListener('loadeddata', function() {
            if (videoContainer) videoContainer.classList.remove('loading');
            console.log('‚úÖ Video loaded successfully');
        });
        
        video.addEventListener('error', function(e) {
            if (videoContainer) videoContainer.classList.remove('loading');
            console.error('‚ùå Video error:', e);
            handleVideoError();
        });
        
        video.addEventListener('play', function() {
            if (playPauseBtn) playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
        });
        
        video.addEventListener('pause', function() {
            if (playPauseBtn) playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        });
        
        video.addEventListener('ended', function() {
            markVideoAsCompleted(currentVideoIndex);
            if (hasNextAvailableVideo()) {
                setTimeout(() => nextVideo(), 1000);
            }
        });
        
        video.addEventListener('timeupdate', function() {
            if (video.currentTime > 10) {
                saveProgress();
            }
        });
    }
    
    function initializeUIEvents() {
        // Play/Pause button
        if (playPauseBtn) {
            playPauseBtn.addEventListener('click', function() {
                if (video.paused) {
                    video.play().catch(e => {
                        console.error('Play error:', e);
                        showNotification('Unable to play video. Please check your connection.', 'danger');
                    });
                } else {
                    video.pause();
                }
            });
        }
        
        // Fullscreen button
        if (fullscreenBtn) {
            fullscreenBtn.addEventListener('click', function() {
                if (video.requestFullscreen) {
                    video.requestFullscreen();
                } else if (video.webkitRequestFullscreen) {
                    video.webkitRequestFullscreen();
                }
            });
        }
        
        // Navigation buttons
        if (prevBtn) prevBtn.addEventListener('click', prevVideo);
        if (nextBtn) nextBtn.addEventListener('click', nextVideo);
        
        // Video item clicks
        videoItems.forEach((item, index) => {
            const isAvailable = item.dataset.available === 'true';
            
            if (isAvailable) {
                item.style.cursor = 'pointer';
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    loadVideo(index);
                });
            } else {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const videoData = videosData[index];
                    showNotification(`Video "${videoData?.title || 'Unknown'}" is not available`, 'warning');
                });
            }
        });
    }
    
    function loadVideo(index) {
        if (index < 0 || index >= totalVideos) return;
        
        const videoData = videosData[index];
        if (!videoData || !videoData.available || !videoData.playback_url) {
            console.warn(`Video at index ${index} is not available`);
            showNotification(`Video "${videoData?.title || 'Unknown'}" is not available`, 'warning');
            return;
        }
        
        console.log(`üé¨ Loading video ${index + 1}/${totalVideos}: ${videoData.title}`);
        console.log(`üì° Source: ${videoData.source_type}, URL: ${videoData.playback_url}`);
        
        currentVideoIndex = index;
        
        // Clear any existing errors
        clearVideoErrors();
        
        // Update video source
        video.src = videoData.playback_url;
        video.load();
        
        // Update UI
        updateVideoUI(videoData, index);
        updateNavigationButtons();
    }
    
    function updateVideoUI(videoData, index) {
        if (currentVideoTitle) currentVideoTitle.textContent = videoData.title;
        if (currentVideoDescription) {
            currentVideoDescription.textContent = videoData.description || 'No description available.';
        }
        if (videoCounter) videoCounter.textContent = `${index + 1} of ${totalVideos}`;
        if (sourceTypeBadge) sourceTypeBadge.textContent = videoData.source_type;
        
        // Update curriculum highlighting
        videoItems.forEach(item => item.classList.remove('current'));
        if (videoItems[index]) videoItems[index].classList.add('current');
    }
    
    function updateNavigationButtons() {
        if (prevBtn) prevBtn.disabled = !hasPreviousAvailableVideo();
        if (nextBtn) {
            nextBtn.disabled = !hasNextAvailableVideo();
            if (!hasNextAvailableVideo() && isLastAvailableVideo()) {
                nextBtn.innerHTML = 'Course Complete!<i class="fas fa-check ms-2"></i>';
            } else {
                nextBtn.innerHTML = 'Next<i class="fas fa-chevron-right ms-2"></i>';
            }
        }
    }
    
    function nextVideo() {
        for (let i = currentVideoIndex + 1; i < totalVideos; i++) {
            if (videosData[i] && videosData[i].available) {
                loadVideo(i);
                return;
            }
        }
        console.log('üìö No more available videos - course complete!');
        showNotification('üéâ You have completed all available videos!', 'success');
    }
    
    function prevVideo() {
        for (let i = currentVideoIndex - 1; i >= 0; i--) {
            if (videosData[i] && videosData[i].available) {
                loadVideo(i);
                return;
            }
        }
        console.log('‚èÆÔ∏è No previous available videos');
    }
    
    function hasNextAvailableVideo() {
        for (let i = currentVideoIndex + 1; i < totalVideos; i++) {
            if (videosData[i] && videosData[i].available) {
                return true;
            }
        }
        return false;
    }
    
    function hasPreviousAvailableVideo() {
        for (let i = currentVideoIndex - 1; i >= 0; i--) {
            if (videosData[i] && videosData[i].available) {
                return true;
            }
        }
        return false;
    }
    
    function isLastAvailableVideo() {
        // Check if current video is the last available one
        for (let i = currentVideoIndex + 1; i < totalVideos; i++) {
            if (videosData[i] && videosData[i].available) {
                return false;
            }
        }
        return true;
    }
    
    function handleVideoError() {
        const currentVideo = videosData[currentVideoIndex];
        console.error('üö® Video playback error for:', currentVideo?.title);
        
        const errorMsg = document.createElement('div');
        errorMsg.className = 'alert alert-danger mt-3 video-error';
        errorMsg.innerHTML = `
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Video Error:</strong> Unable to load "${currentVideo?.title || 'Unknown Video'}"
            <br><small>Source: ${currentVideo?.source_type || 'unknown'} | URL: ${currentVideo?.playback_url || 'none'}</small>
            <div class="mt-2">
                <button onclick="retryCurrentVideo()" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-redo me-1"></i>Retry
                </button>
                <button onclick="skipCurrentVideo()" class="btn btn-sm btn-outline-warning">
                    <i class="fas fa-forward me-1"></i>Skip Video
                </button>
                {% if current_user.is_admin %}
                    <a href="/admin/reupload-videos" target="_blank" class="btn btn-sm btn-outline-info">
                        <i class="fas fa-upload me-1"></i>Fix Videos
                    </a>
                {% endif %}
            </div>
        `;
        
        // Insert error message after video container
        const container = video.parentNode;
        container.appendChild(errorMsg);
    }
    
    function clearVideoErrors() {
        const errors = document.querySelectorAll('.video-error');
        errors.forEach(error => error.remove());
    }
    
    function markVideoAsCompleted(index) {
        const videoItem = videoItems[index];
        if (videoItem) {
            videoItem.classList.add('completed');
            const statusIcon = videoItem.querySelector('.lesson-status i');
            if (statusIcon) {
                statusIcon.className = 'fas fa-check';
            }
        }
        updateProgress();
        saveProgress();
    }
    
    function updateProgress() {
        const completedVideos = document.querySelectorAll('.video-item.completed').length;
        const availableCount = availableVideos.length;
        const percentage = availableCount > 0 ? Math.round((completedVideos / availableCount) * 100) : 0;
        
        const progressBar = document.getElementById('overallProgress');
        const progressPercentage = document.getElementById('progressPercentage');
        const completedLessons = document.getElementById('completedLessons');
        
        if (progressBar) {
            progressBar.style.width = percentage + '%';
            progressBar.setAttribute('aria-valuenow', percentage);
        }
        if (progressPercentage) progressPercentage.textContent = percentage + '%';
        if (completedLessons) completedLessons.textContent = completedVideos;
        
        console.log(`üìä Progress updated: ${completedVideos}/${availableCount} (${percentage}%)`);
    }
    
    function saveProgress() {
        const courseId = {{ course.id }};
        const completedVideos = Array.from(document.querySelectorAll('.video-item.completed'))
            .map(item => parseInt(item.dataset.videoIndex));
        
        const progressData = {
            completedVideos: completedVideos,
            currentVideo: currentVideoIndex,
            timestamp: new Date().toISOString()
        };
        
        localStorage.setItem(`course_${courseId}_progress`, JSON.stringify(progressData));
        console.log('üíæ Progress saved:', progressData);
    }
    
    function loadProgress() {
        const courseId = {{ course.id }};
        const saved = localStorage.getItem(`course_${courseId}_progress`);
        
        if (saved) {
            try {
                const progress = JSON.parse(saved);
                console.log('üìÇ Loading saved progress:', progress);
                
                // Mark completed videos
                if (progress.completedVideos && Array.isArray(progress.completedVideos)) {
                    progress.completedVideos.forEach(index => {
                        if (index >= 0 && index < totalVideos) {
                            markVideoAsCompleted(index);
                        }
                    });
                }
                
                // Load last video if available
                if (progress.currentVideo >= 0 && progress.currentVideo < totalVideos) {
                    const videoData = videosData[progress.currentVideo];
                    if (videoData && videoData.available) {
                        currentVideoIndex = progress.currentVideo;
                        return; // Don't load video yet, let the main initialization handle it
                    }
                }
            } catch (e) {
                console.warn('Error loading progress:', e);
            }
        }
        
        console.log('üÜï No saved progress found, starting fresh');
    }
    
    // Global functions for error handling
    window.retryCurrentVideo = function() {
        console.log('üîÑ Retrying current video...');
        clearVideoErrors();
        loadVideo(currentVideoIndex);
    };
    
    window.skipCurrentVideo = function() {
        console.log('‚è≠Ô∏è Skipping current video...');
        clearVideoErrors();
        if (hasNextAvailableVideo()) {
            nextVideo();
        } else {
            showNotification('No more videos to skip to.', 'info');
        }
    };
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (!video || availableVideos.length === 0) return;
        
        // Only handle shortcuts when not typing in inputs
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        
        switch(e.key) {
            case ' ': // Space bar - play/pause
                e.preventDefault();
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
                break;
                
            case 'ArrowLeft': // Left arrow - previous video
                e.preventDefault();
                prevVideo();
                break;
                
            case 'ArrowRight': // Right arrow - next video
                e.preventDefault();
                nextVideo();
                break;
                
            case 'f': // F key - fullscreen
            case 'F':
                e.preventDefault();
                if (video.requestFullscreen) {
                    video.requestFullscreen();
                }
                break;
                
            case 'm': // M key - mute/unmute
            case 'M':
                e.preventDefault();
                video.muted = !video.muted;
                break;
        }
    });
    
    console.log('üé¨ Video player setup complete!');
    console.log(`üìà Available features: ${availableVideos.length > 0 ? 'Full video player' : 'Text-based course'}`);
});

function showNotification(message, type = 'info') {
    // Remove existing notifications
    const existing = document.querySelectorAll('.toast-notification');
    existing.forEach(n => n.remove());
    
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed toast-notification`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 400px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 5000);
    
    console.log(`üì¢ Notification: ${message}`);
}

// Initialize tooltips if Bootstrap is available
document.addEventListener('DOMContentLoaded', function() {
    if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    }
});
</script>
{% endblock %}
