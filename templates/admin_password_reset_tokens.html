{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-0">ðŸ”’ Password Reset Tokens</h1>
                    <p class="text-muted">Monitor and manage password reset requests</p>
                </div>
                <div>
                    <button class="btn btn-outline-danger btn-sm" onclick="cleanupExpiredTokens()">
                        <i class="fas fa-trash me-2"></i>Cleanup Expired
                    </button>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card stat-total">
                        <div class="stat-icon">
                            <i class="fas fa-key"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ total_tokens }}</h3>
                            <p>Total Tokens (7 days)</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card stat-active">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ active_tokens }}</h3>
                            <p>Active Tokens</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card stat-used">
                        <div class="stat-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ used_tokens }}</h3>
                            <p>Used Tokens</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card stat-expired">
                        <div class="stat-icon">
                            <i class="fas fa-times"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ expired_tokens }}</h3>
                            <p>Expired Tokens</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tokens Table -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-list me-2"></i>Recent Password Reset Tokens
                    </h5>
                </div>
                <div class="card-body">
                    {% if tokens %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Email</th>
                                        <th>Token</th>
                                        <th>Created</th>
                                        <th>Expires</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for token in tokens %}
                                    <tr class="token-row {% if token.used %}used{% elif token.is_expired() %}expired{% else %}active{% endif %}">
                                        <td>
                                            <div class="user-info">
                                                <strong>{{ token.user.first_name }} {{ token.user.last_name }}</strong>
                                                <br>
                                                <small class="text-muted">{{ token.user.username }}</small>
                                            </div>
                                        </td>
                                        <td>
                                            <a href="mailto:{{ token.user.email }}" class="text-decoration-none">
                                                {{ token.user.email }}
                                            </a>
                                        </td>
                                        <td>
                                            <code class="token-code">{{ token.token[:16] }}...</code>
                                            <button class="btn btn-sm btn-outline-secondary ms-2" 
                                                    onclick="copyToken('{{ token.token }}')" 
                                                    title="Copy full token">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </td>
                                        <td>
                                            <small>
                                                {{ token.created_at.strftime('%Y-%m-%d %H:%M') }}
                                                <br>
                                                <span class="text-muted">{{ (now - token.created_at).total_seconds() // 60 | int }} min ago</span>
